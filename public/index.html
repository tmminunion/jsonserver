<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="./index.css" />
    <link href="assets/css/bootstrap-responsive.css" rel="stylesheet" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />

    <title>Base64 File Upload</title>
  </head>

  <body>
    <div style="margin: 24px">
      <h2>Upload Image</h2>
    </div>

    <div style="margin: 16px; padding: 16px">
      <input
        class="form-control form-control-lg"
        id="selectAvatar"
        type="file"
      />
    </div>

    <div class="container">
      <div class="row">
        <div class="col">
          <h6>Image Preview:</h6>
          <img class="img" id="avatar" width="100%" />
        </div>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <div class="col">
          <h2>link image</h2>
          <h6 id="namalink"></h6>
        </div>
      </div>
    </div>

    <script>
      const input = document.getElementById("selectAvatar");
      const avatar = document.getElementById("avatar");
      const namalink = document.getElementById("namalink");

      const estring = (myLength) => {
        const chars =
          "AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz1234567890";
        const randomArray = Array.from(
          { length: myLength },
          (v, k) => chars[Math.floor(Math.random() * chars.length)]
        );

        const randomString = randomArray.join("");
        return Date.now() + randomString;
      };

      const convertBase64 = (file) => {
        return new Promise((resolve, reject) => {
          const fileReader = new FileReader();
          fileReader.readAsDataURL(file);

          fileReader.onload = () => {
            resolve(fileReader.result);
          };

          fileReader.onerror = (error) => {
            reject(error);
          };
        });
      };

      const uploadImage = async (event) => {
        const file = event.target.files[0];
        const base64 = await convertBase64(file);
        avatar.src = base64;
        const idnya = estring(17);

        namalink.innerHTML = `<a href="https://bungtemin.net/images/pic/${idnya}">https://bungtemin.net/images/pic/${idnya}</a>`;
        var myHeaders = new Headers();

        myHeaders.append("Content-Type", "application/json");

        var raw = JSON.stringify({
          id: idnya,
          model: "to",
          data: base64,
        });

        var requestOptions = {
          method: "POST",
          headers: myHeaders,
          body: raw,
          redirect: "follow",
        };

        fetch("", requestOptions)
          .then((response) => response.text())
          .then((result) => console.log(result))
          .catch((error) => console.log("error", error));
      };

      input.addEventListener("change", (e) => {
        uploadImage(e);
      });
    </script>
  </body>
</html>
